<!DOCTYPE html>
<html>

<head>
  <title>mfinance Server</title>
  <style>
    body {
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    th,
    td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }

    th:nth-child(1) {
      text-align: left;
    }

    th:nth-child(2) {
      text-align: right;
    }

    td:nth-child(2) {
      text-align: right;
      font-family: 'Consolas', 'Menlo', 'DejaVu Sans Mono', monospace;
    }

    th {
      background-color: #f2f2f2;
    }

    .total-row {
      background-color: #e6f3ff;
    }

    .total-row td {
      border-bottom: none;
      padding-top: 12px;
    }

    .year-header {
      cursor: pointer;
      background-color: #f8f9fa;
    }

    .year-header:hover {
      background-color: #e9ecef;
    }

    .year-header td {
      font-weight: bold;
      padding: 8px;
    }

    .tab {
      cursor: pointer;
      padding: 10px 20px;
      margin-right: 5px;
      background-color: #f0f0f0;
      border: 1px solid #ddd;
      border-radius: 4px 4px 0 0;
      transition: background-color 0.2s;
    }

    .tab:hover {
      background-color: #e0e0e0;
    }

    .active {
      background-color: #e3f2fd;
      border-color: #2196F3;
      color: #0d47a1;
      border-bottom: 2px solid #2196F3;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    #tabs {
      margin-bottom: 1rem;
    }
  </style>
</head>

<body>
  <div id="tabs"></div>
  <div id="content"></div>

  <script>
    function toggleYear(year) {
      const element = document.getElementById(year);
      if (element.style.display === 'none') {
        element.style.display = 'table-row-group'
      } else {
        element.style.display = 'none';
      }
    }

    async function loadFile(filename) {
      const response = await fetch(`/api/files/${filename}`);
      const data = await response.json();

      const html = `
      <table>
        <tr><th>Date</th><th>Amount</th></tr>
        ${data.years.map(year => `
          <tr class="year-header" onclick="toggleYear('${year.year}')">
            <td>${year.year}</td>
            <td>${year.subtotal}</td>
          </tr>
          <tbody id="${year.year}" style="display: none;">
            ${year.entries.map(e => `
              <tr><td>${e.date}</td><td>${e.amount}</td></tr>
            `).join('')}
          </tbody>
        `).join('')}
        <tr class="total-row">
          <td><strong>Grand Total:</strong></td>
          <td><strong>${data.total}</strong></td>
        </tr>
      </table>
    `;
      document.getElementById('content').innerHTML = html;
    }

    (async () => {
      const res = await fetch('/api/files');
      const files = await res.json();
      const tabs = document.getElementById('tabs');

      files.forEach(file => {
        const tab = document.createElement('span');
        tab.className = 'tab';
        tab.textContent = file;
        tab.onclick = () => {
          // Remove active class from all tabs
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          // Add active class to clicked tab
          tab.classList.add('active');
          loadFile(file);
        };
        tabs.appendChild(tab);
      });

      if (files.length > 0) {
        loadFile(files[0]);
        tabs.children[0].classList.add('active');
      }
    })();
  </script>
</body>

</html>